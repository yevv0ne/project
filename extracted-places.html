<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>추출된 장소 정보 - PlacePick</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <!-- 네이버 지도 API 불러오기 -->
    <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=hk7y7c86pt&submodules=geocoder"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="api.js"></script>
    <script src="app.js"></script>

    <style>
        body {
            background: #f4f6fb;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .header {
            background: linear-gradient(135deg, #9575cd, #b39ddb);
            color: white;
            padding: 2rem 0;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .header h1 {
            font-weight: 700;
            margin: 0;
            font-size: 2.5rem;
        }
        
        .places-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .place-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 20px rgba(149,117,205,0.1);
            border: 1px solid #ede7f6;
            transition: all 0.3s ease;
        }
        
        .place-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(149,117,205,0.15);
        }
        
        .place-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .place-address {
            color: #666;
            font-size: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .location-icon {
            color: #e91e63;
            font-size: 1.1rem;
        }
        
        .status-message {
            color: #666;
            font-size: 0.9rem;
            font-style: italic;
        }
        
        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        .btn-search {
            background: #f5f5f5;
            border: 1px solid #ddd;
            color: #666;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .btn-search:hover {
            background: #e0e0e0;
            color: #333;
        }
        
        .btn-view-map {
            background: linear-gradient(135deg, #9575cd, #b39ddb);
            border: none;
            color: white;
            border-radius: 8px;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .btn-view-map:hover {
            background: linear-gradient(135deg, #7e57c2, #9575cd);
            color: white;
            transform: translateY(-1px);
        }
        
        .back-button {
            position: fixed;
            top: 2rem;
            left: 2rem;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50px;
            padding: 0.8rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .back-button:hover {
            background: white;
            transform: scale(1.1);
        }
        
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }
        
        .empty-state i {
            font-size: 4rem;
            color: #b39ddb;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .places-container {
                padding: 0 0.5rem;
            }
            
            .place-card {
                padding: 1rem;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .back-button {
                top: 1rem;
                left: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- 뒤로가기 버튼 -->
    <button class="back-button" onclick="goBack()">
        <i class="bi bi-arrow-left"></i>
    </button>

    <!-- 헤더 -->
    <div class="header">
        <h1>추출된 장소 정보</h1>
    </div>

    <!-- 장소 정보 컨테이너 -->
    <div class="places-container">
        <div id="placesList">
            <!-- 장소 카드들이 여기에 동적으로 추가됩니다 -->
        </div>
        
        <!-- 빈 상태 표시 -->
        <div id="emptyState" class="empty-state" style="display: none;">
            <i class="bi bi-geo-alt"></i>
            <h3>아직 추출된 장소가 없습니다</h3>
            <p>이미지나 URL에서 장소 정보를 추출해보세요!</p>
            <button class="btn btn-primary" onclick="goToMain()">메인으로 이동</button>
        </div>
    </div>

    <!-- 네이버 지도 모달 -->
    <div class="modal fade" id="mapModal" tabindex="-1" aria-labelledby="mapModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="mapModalLabel">지도에서 보기</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="map" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let map = null;
        let extractedPlaces = [];

        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', function() {
            loadExtractedPlaces();
        });

        // 뒤로가기 함수
        function goBack() {
            if (window.history.length > 1) {
                window.history.back();
            } else {
                window.location.href = 'index-map.html';
            }
        }

        // 메인으로 이동
        function goToMain() {
            window.location.href = 'index-map.html';
        }

        // 추출된 장소 정보 로드
        function loadExtractedPlaces() {
            const places = JSON.parse(localStorage.getItem('extractedPlaces') || '[]');
            extractedPlaces = places;
            
            if (places.length === 0) {
                document.getElementById('emptyState').style.display = 'block';
                document.getElementById('placesList').style.display = 'none';
            } else {
                document.getElementById('emptyState').style.display = 'none';
                document.getElementById('placesList').style.display = 'block';
                renderPlaces(places);
            }
        }

        // 장소 정보 렌더링
        function renderPlaces(places) {
            const container = document.getElementById('placesList');
            container.innerHTML = '';

            places.forEach((place, index) => {
                const placeCard = createPlaceCard(place, index);
                container.appendChild(placeCard);
            });
        }

        // 장소 카드 생성
        function createPlaceCard(place, index) {
            const card = document.createElement('div');
            card.className = 'place-card';
            
            let statusHtml = '';
            let buttonHtml = '';
            
            if (place.address && place.address !== '주소를 찾을 수 없습니다') {
                // 주소가 있는 경우
                statusHtml = `
                    <div class="place-address">
                        <i class="bi bi-geo-alt-fill location-icon"></i>
                        ${place.address}
                    </div>
                `;
                buttonHtml = `
                    <button class="btn-view-map" onclick="viewOnMap(${index})">
                        <i class="bi bi-map"></i>
                        지도에서 보기
                    </button>
                `;
            } else {
                // 주소가 없는 경우
                statusHtml = `
                    <div class="place-address">
                        <strong>${place.name || '알 수 없는 장소'}</strong>
                    </div>
                    <div class="status-message">주소를 찾을 수 없습니다</div>
                `;
                buttonHtml = `
                    <button class="btn-search" onclick="searchPlace(${index})">
                        <i class="bi bi-search"></i>
                        검색
                    </button>
                `;
            }
            
            card.innerHTML = `
                ${statusHtml}
                <div class="action-buttons">
                    ${buttonHtml}
                </div>
            `;
            
            return card;
        }

        // 지도에서 보기
        function viewOnMap(index) {
            const place = extractedPlaces[index];
            if (!place || !place.lat || !place.lng) {
                alert('지도에 표시할 수 있는 좌표 정보가 없습니다.');
                return;
            }

            // 모달 제목 설정
            document.getElementById('mapModalLabel').textContent = place.name || '장소';
            
            // 모달 표시
            const mapModal = new bootstrap.Modal(document.getElementById('mapModal'));
            mapModal.show();
            
            // 지도 초기화 (모달이 완전히 표시된 후)
            setTimeout(() => {
                initMap(place.lat, place.lng, place.name);
            }, 300);
        }

        // 지도 초기화
        function initMap(lat, lng, placeName) {
            if (map) {
                map.destroy();
            }
            
            map = new naver.maps.Map('map', {
                center: new naver.maps.LatLng(lat, lng),
                zoom: 15
            });
            
            // 마커 추가
            const marker = new naver.maps.Marker({
                position: new naver.maps.LatLng(lat, lng),
                map: map
            });
            
            // 정보창 추가
            const infoWindow = new naver.maps.InfoWindow({
                content: `<div style="padding: 10px;"><strong>${placeName}</strong></div>`
            });
            
            // 마커 클릭 시 정보창 표시
            naver.maps.Event.addListener(marker, 'click', function() {
                infoWindow.open(map, marker);
            });
        }

        // 장소 검색
        function searchPlace(index) {
            const place = extractedPlaces[index];
            if (!place || !place.name) {
                alert('검색할 장소명이 없습니다.');
                return;
            }
            
            // 네이버 검색으로 이동
            const searchUrl = `https://search.naver.com/search.naver?query=${encodeURIComponent(place.name)}`;
            window.open(searchUrl, '_blank');
        }

        // 장소 정보 추가 (다른 페이지에서 호출)
        window.addExtractedPlace = function(placeData) {
            const places = JSON.parse(localStorage.getItem('extractedPlaces') || '[]');
            places.push(placeData);
            localStorage.setItem('extractedPlaces', JSON.stringify(places));
            
            // 현재 페이지가 추출된 장소 페이지라면 새로고침
            if (window.location.pathname.includes('extracted-places.html')) {
                loadExtractedPlaces();
            }
        };

        // 장소 정보 삭제
        function removePlace(index) {
            if (confirm('이 장소 정보를 삭제하시겠습니까?')) {
                const places = JSON.parse(localStorage.getItem('extractedPlaces') || '[]');
                places.splice(index, 1);
                localStorage.setItem('extractedPlaces', JSON.stringify(places));
                loadExtractedPlaces();
            }
        }
    </script>
</body>
</html>
